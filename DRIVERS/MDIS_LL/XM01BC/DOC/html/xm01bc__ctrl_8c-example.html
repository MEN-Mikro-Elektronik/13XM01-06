<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - XM01BC MDIS Driver - Example Documentation</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">XM01BC MDIS Driver &nbsp; </h1>
	<h3>Example Documentation</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>xm01bc_ctrl.c</h1><div class="fragment"><pre><span class="comment">/****************************************************************************</span>
<span class="comment"> ************                                                    ************</span>
<span class="comment"> ************                  XM01BC_CTRL                       ************</span>
<span class="comment"> ************                                                    ************</span>
<span class="comment"> ****************************************************************************/</span>
 <span class="comment">/*-------------------------------[ History ]--------------------------------</span>
<span class="comment"> *</span>
<span class="comment"> * $Log: xm01bc_ctrl.c,v $</span>
<span class="comment"> * Revision 1.3  2009/09/04 11:57:40  MRoth</span>
<span class="comment"> * R: Porting to MDIS5</span>
<span class="comment"> * M: added support for 64bit (MDIS_PATH)</span>
<span class="comment"> *</span>
<span class="comment"> * Revision 1.2  2009/02/06 15:46:20  MSoehnlein</span>
<span class="comment"> * R:1. Added MM1/ XM2/ F19 Support</span>
<span class="comment"> * M:1.a) added "Hardware ID" query</span>
<span class="comment"> *     b) added "Number of Supervised Voltages" query</span>
<span class="comment"> *     c) added "Number of Error Counters" query</span>
<span class="comment"> *     d) added "RESET_IN Blocking Mode" query</span>
<span class="comment"> *     e) increased number of error counters to 31</span>
<span class="comment"> *     f) increased number of supervised voltages to 8</span>
<span class="comment"> *     g) renamed Board Controller Interface (BCI) from XM01BCI to CPUBCI</span>
<span class="comment"> *</span>
<span class="comment"> * Revision 1.1  2008/10/31 17:13:38  MSoehnlein</span>
<span class="comment"> * Initial Revision</span>
<span class="comment"> *</span>
<span class="comment"> *</span>
<span class="comment"> *---------------------------------------------------------------------------</span>
<span class="comment"> * (c) Copyright 2008 by MEN mikro elektronik GmbH, Nuernberg, Germany</span>
<span class="comment"> ****************************************************************************/</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/men_typs.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/usr_oss.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/usr_utl.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/mdis_api.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/mdis_err.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="xm01bc__drv_8h.html">MEN/xm01bc_drv.h</a>&gt;</span>

<span class="comment">/*--------------------------------------+</span>
<span class="comment">|   DEFINES                             |</span>
<span class="comment">+--------------------------------------*/</span>
<span class="preprocessor">#define NONE            0</span>
<span class="preprocessor"></span><span class="preprocessor">#define MAX_VOLT_CH     8</span>
<span class="preprocessor"></span>
<span class="comment">/*--------------------------------------+</span>
<span class="comment">|   GLOBALS                             |</span>
<span class="comment">+--------------------------------------*/</span>
<span class="keyword">static</span> <a class="code" href="xm01bc__drv_8h.html#a72">MDIS_PATH</a> G_Path;

<span class="keyword">static</span> <span class="keyword">struct </span>{
    u_int32 <a class="code" href="xm01bc__ctrl_8c.html#a3">low</a>;
    u_int32 <a class="code" href="xm01bc__ctrl_8c.html#a4">high</a>;
} G_VoltCh[<a class="code" href="xm01bc__ctrl_8c.html#a1">MAX_VOLT_CH</a>];    <span class="comment">/* volt channel limits */</span>

<span class="comment">/*--------------------------------------+</span>
<span class="comment">|   PROTOTYPES                          |</span>
<span class="comment">+--------------------------------------*/</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> <a name="a5"></a><a class="code" href="xm01bc__ctrl_8c.html#a6">usage</a>(<span class="keywordtype">void</span>);
<span class="keyword">static</span> <span class="keywordtype">void</span> <a name="a6"></a><a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="keywordtype">char</span> *info);
<span class="keyword">static</span> <span class="keywordtype">void</span> <a name="a7"></a><a class="code" href="xm01bc__ctrl_8c.html#a8">PrintUosError</a>(<span class="keywordtype">char</span> *info);

<span class="comment">/********************************* usage ***********************************/</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="xm01bc__ctrl_8c.html#a6">usage</a>(<span class="keywordtype">void</span>)
{
    printf(<span class="stringliteral">"Usage: xm01bc_ctrl [&lt;opts&gt;] &lt;device&gt; [&lt;opts&gt;]            \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"Function: Control XM01BC PIC                             \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"Options:                                                 \n"</span>);
    printf(<span class="stringliteral">"  device      device name                                \n"</span>);
    printf(<span class="stringliteral">"  -v          show voltage values                        \n"</span>);
    printf(<span class="stringliteral">"  -s          do voltage supervision (requires option -v)\n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -r=0xdead   perform SW warm reset (!! dangerous !!)    \n"</span>);
    printf(<span class="stringliteral">"  -R=0xdead   perform SW cold reset (!! dangerous !!)    \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -e          show error counters                        \n"</span>);
    printf(<span class="stringliteral">"  -c          clear error counters                       \n"</span>);
    printf(<span class="stringliteral">"  -n          get number of error counters               \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -f          show firmware revision                     \n"</span>);
    printf(<span class="stringliteral">"  -F          show firmware revision extended            \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -w          show last reset reason                     \n"</span>);
    printf(<span class="stringliteral">"  -x          show last error                            \n"</span>);
    printf(<span class="stringliteral">"  -y          show power failure flag                    \n"</span>);
    printf(<span class="stringliteral">"  -z          clear failure registers                    \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -o          show operating hours counter               \n"</span>);
    printf(<span class="stringliteral">"  -p          show power cycle counter                   \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -l          get LED state                              \n"</span>);
    printf(<span class="stringliteral">"  -L=&lt;state&gt;  set LED state                              \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -u          get power resume mode                      \n"</span>);
    printf(<span class="stringliteral">"  -a          get EXT_PWR_OK resume mode                 \n"</span>);
    printf(<span class="stringliteral">"  -b          get RESET_IN mode                          \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -h          get hardware variant ID                    \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"  -q          exit QM-Mode (for production tests only)   \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"(c) 2008 by MEN mikro elektronik GmbH                    \n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
    printf(<span class="stringliteral">"\n"</span>);
}

<span class="comment">/********************************* main ************************************/</span>
<span class="keywordtype">int</span> <a name="a8"></a><a class="code" href="xm01bc__ctrl_8c.html#a9">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordtype">char</span>    *device,*str,*errstr,buf[40];
    int32   volt, superv, swr, scr, err, clear, frev, frev_ext;
    int32   lastReason, lastError, powerFail, clearFail, opHours, pwrCycle;
    int32   getLedState, setLedState, newLedState;
    int32   getResumeMode, getExtMode, getResetMode;
    int32   getHwVariant, getNumErrCntrs;
    int32   exitQmMode;
    int32   n, val, ch;
    int32   chNbr, in;
    int32   errCntrNbr;

    printf(<span class="stringliteral">"\n"</span>);

    <span class="comment">/*--------------------+</span>
<span class="comment">    |  check arguments    |</span>
<span class="comment">    +--------------------*/</span>
    <span class="keywordflow">if</span>( (errstr = UTL_ILLIOPT(<span class="stringliteral">"vsr=R=ecnfFwxyzoplL=uabhq?"</span>, buf)) ) <span class="comment">/* check args */</span>
    {
        printf(<span class="stringliteral">"*** %s\n"</span>, errstr);
        <span class="keywordflow">return</span>(1);
    }

    <span class="keywordflow">if</span>( UTL_TSTOPT(<span class="stringliteral">"?"</span>) )                       <span class="comment">/* help requested ? */</span>
    {
        <a class="code" href="xm01bc__ctrl_8c.html#a6">usage</a>();
        <span class="keywordflow">return</span>(1);
    }

    <span class="comment">/*--------------------+</span>
<span class="comment">    |  get arguments      |</span>
<span class="comment">    +--------------------*/</span>
    <span class="keywordflow">for</span> (device=NULL, n=1; n&lt;argc; n++)
        <span class="keywordflow">if</span>( *argv[n] != <span class="charliteral">'-'</span> )
        {
            device = argv[n];
            <span class="keywordflow">break</span>;
        }

    <span class="keywordflow">if</span>( !device || argc&lt;3 )
    {
        <a class="code" href="xm01bc__ctrl_8c.html#a6">usage</a>();
        <span class="keywordflow">return</span>(1);
    }

    volt = (UTL_TSTOPT(<span class="stringliteral">"v"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);
    superv = (UTL_TSTOPT(<span class="stringliteral">"s"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);
    <span class="keywordflow">if</span>( superv &amp;&amp; !volt )
    {
        printf(<span class="stringliteral">"*** option -s requires option -v\n"</span>);
        <span class="keywordflow">return</span>(1);
    }

    <span class="comment">/* Software warm reset */</span>
    <span class="keywordflow">if</span>( (str = UTL_TSTOPT(<span class="stringliteral">"r="</span>)) )
        sscanf( str, <span class="stringliteral">"%x"</span>, &amp;swr );
    <span class="keywordflow">else</span>
        swr = <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>;

    <span class="comment">/* Software cold reset */</span>
    <span class="keywordflow">if</span>( (str = UTL_TSTOPT(<span class="stringliteral">"R="</span>)) )
        sscanf( str, <span class="stringliteral">"%x"</span>, &amp;scr );
    <span class="keywordflow">else</span>
        scr = <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>;


    <span class="comment">/* Show error counters */</span>
    err = (UTL_TSTOPT(<span class="stringliteral">"e"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Clear error counters */</span>
    clear = (UTL_TSTOPT(<span class="stringliteral">"c"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Show firmware revision */</span>
    frev = (UTL_TSTOPT(<span class="stringliteral">"f"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Show firmware revision extended */</span>
    frev_ext = (UTL_TSTOPT(<span class="stringliteral">"F"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);


    <span class="comment">/* Show last reset reason */</span>
    lastReason = (UTL_TSTOPT(<span class="stringliteral">"w"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Show last error */</span>
    lastError = (UTL_TSTOPT(<span class="stringliteral">"x"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Show power failure flags */</span>
    powerFail = (UTL_TSTOPT(<span class="stringliteral">"y"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Clear failure registers */</span>
    clearFail = (UTL_TSTOPT(<span class="stringliteral">"z"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);


    <span class="comment">/* Show operating hours counter */</span>
    opHours = (UTL_TSTOPT(<span class="stringliteral">"o"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* Show power cycle counter */</span>
    pwrCycle = (UTL_TSTOPT(<span class="stringliteral">"p"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);


    <span class="comment">/* get LED state */</span>
    getLedState = (UTL_TSTOPT(<span class="stringliteral">"l"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* set LED state */</span>
    <span class="keywordflow">if</span>( (str = UTL_TSTOPT(<span class="stringliteral">"L="</span>)) )
    {
        sscanf( str, <span class="stringliteral">"%x"</span>, &amp;newLedState );
        setLedState = 1;
    }
    <span class="keywordflow">else</span>
        setLedState = <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>;


    <span class="comment">/* get power resume mode */</span>
    getResumeMode = (UTL_TSTOPT(<span class="stringliteral">"u"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);


    <span class="comment">/* get ATX_PWR_OK mode */</span>
    getExtMode = (UTL_TSTOPT(<span class="stringliteral">"a"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);


    <span class="comment">/* get RESET_IN mode */</span>
    getResetMode = (UTL_TSTOPT(<span class="stringliteral">"b"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* exit QM-Mode */</span>
    exitQmMode = (UTL_TSTOPT(<span class="stringliteral">"q"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);


    <span class="comment">/* get hardware variant */</span>
    getHwVariant = (UTL_TSTOPT(<span class="stringliteral">"h"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);

    <span class="comment">/* get number of error counters */</span>
    getNumErrCntrs = (UTL_TSTOPT(<span class="stringliteral">"n"</span>) ? 1 : <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>);



    <span class="comment">/*--------------------+</span>
<span class="comment">    |  open path          |</span>
<span class="comment">    +--------------------*/</span>
    <span class="keywordflow">if</span>( (G_Path = M_open(device)) &lt; 0)
    {
        <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"open"</span>);
        <span class="keywordflow">return</span>(1);
    }

    <span class="comment">/*----------------------+</span>
<span class="comment">    |  show voltage values  |</span>
<span class="comment">    +----------------------*/</span>
    <span class="keywordflow">if</span>( volt != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        printf( <span class="stringliteral">"ch    in[mV]     lower limit[mV]     upper limit[mV]\n"</span>);


        <span class="keywordflow">if</span> ((M_getstat(G_Path, M_LL_CH_NUMBER, &amp;chNbr)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat M_LL_CH_NUMBER"</span>);
            <span class="keywordflow">goto</span> abort;
        }

        <span class="keywordflow">if</span>( chNbr &gt; <a class="code" href="xm01bc__ctrl_8c.html#a1">MAX_VOLT_CH</a> ){
            printf(<span class="stringliteral">"xm01bc_ctrl supports only %d volt-ch (drv. reports %d)"</span>,
                MAX_VOLT_CH, chNbr);
            chNbr = <a class="code" href="xm01bc__ctrl_8c.html#a1">MAX_VOLT_CH</a>;
        }

        <span class="keywordflow">for</span>( ch=0; ch&lt;chNbr; ch++ )
        {
            <span class="comment">/* select channel */</span>
            <span class="keywordflow">if</span>( (M_setstat(G_Path, M_MK_CH_CURRENT, ch)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat M_MK_CH_CURRENT"</span>);
                <span class="keywordflow">goto</span> abort;
            }

            <span class="comment">/* get in voltage */</span>
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_VOLT_ACT, &amp;in)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_VOLT_ACT"</span>);
                <span class="keywordflow">goto</span> abort;
            }

            <span class="comment">/* get lower voltage limit */</span>
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_VOLT_LOW, &amp;G_VoltCh[ch].low)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_VOLT_LOW"</span>);
                <span class="keywordflow">goto</span> abort;
            }

            <span class="comment">/* get upper voltage limit */</span>
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_VOLT_HIGH, &amp;G_VoltCh[ch].high)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_VOLT_HIGH"</span>);
                <span class="keywordflow">goto</span> abort;
            }

            printf(<span class="stringliteral">" %d     %5d               "</span>, ch, in);

            <span class="keywordflow">if</span>( G_VoltCh[ch].low )
                printf(<span class="stringliteral">"%5d               "</span>, G_VoltCh[ch].low);
            <span class="keywordflow">else</span>
                printf(<span class="stringliteral">" -                "</span>);

            <span class="keywordflow">if</span>( G_VoltCh[ch].high )
                printf(<span class="stringliteral">"%5d\n"</span>, G_VoltCh[ch].high);
            <span class="keywordflow">else</span>
                printf(<span class="stringliteral">"    -\n"</span>);
        }

        printf(<span class="stringliteral">"\n"</span>);
    }


    <span class="comment">/*----------------------+</span>
<span class="comment">    |  voltage supervision  |</span>
<span class="comment">    +----------------------*/</span>
    <span class="keywordflow">if</span>( superv != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        u_int32 rcvSig;
        int32   lastSvState;

        printf(<span class="stringliteral">"Voltage supervision:\n"</span>);
        printf(<span class="stringliteral">"The driver polls the voltage supervision state and sends\n"</span>);
        printf(<span class="stringliteral">"a signal to the app. if a voltage over-/underrun occures.\n"</span>);
        printf(<span class="stringliteral">"Then, the app. gets the last polled voltage supervision state.\n"</span>);

        <span class="keywordflow">if</span> ((M_getstat(G_Path, M_LL_CH_NUMBER, &amp;chNbr)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat M_LL_CH_NUMBER"</span>);
            <span class="keywordflow">goto</span> abort;
        }

        <span class="keywordflow">if</span>( chNbr &gt; <a class="code" href="xm01bc__ctrl_8c.html#a1">MAX_VOLT_CH</a> ){
            printf(<span class="stringliteral">"xm01bc_ctrl supports only %d volt-ch (drv. reports %d)"</span>,
                MAX_VOLT_CH, chNbr);
            chNbr = <a class="code" href="xm01bc__ctrl_8c.html#a1">MAX_VOLT_CH</a>;
        }

        <span class="comment">/* init signal handling */</span>
        <span class="keywordflow">if</span>( UOS_SigInit(NULL) )
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a8">PrintUosError</a>(<span class="stringliteral">"SigInit"</span>);
            <span class="keywordflow">return</span>(1);
        }

        <span class="comment">/* install signal */</span>
        <span class="keywordflow">if</span>( UOS_SigInstall(UOS_SIG_USR1) )
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a8">PrintUosError</a>(<span class="stringliteral">"SigInstall"</span>);
            <span class="keywordflow">goto</span> abort;
        }

        UOS_SigMask();

        <span class="comment">/* install signal for voltage supervision */</span>
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_VOLT_SIGSET, (int32)UOS_SIG_USR1) &lt; 0))
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_VOLT_SIGSET"</span>);
            <span class="keywordflow">goto</span> abort;
        }

        printf(<span class="stringliteral">"--- press any key to abort ---\n"</span>);

        <span class="keywordflow">do</span> {
            UOS_SigWait( 100, &amp;rcvSig );

            <span class="comment">/* our signal? */</span>
            <span class="keywordflow">if</span>( rcvSig == UOS_SIG_USR1 )
            {

                <span class="comment">/* get last supervision error state */</span>
                <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_VOLT_SVSTATE, &amp;lastSvState)) &lt; 0)
                {
                    <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_VOLT_SVSTATE"</span>);
                    <span class="keywordflow">goto</span> abort;
                }

                <span class="keywordflow">for</span>( ch=0; ch&lt;chNbr; ch++ )
                {

                    <span class="keywordflow">if</span>( !G_VoltCh[ch].low &amp;&amp; !G_VoltCh[ch].high)
                        <span class="keywordflow">continue</span>;

                    <span class="comment">/* voltage out of range? */</span>
                    <span class="keywordflow">if</span>( 0x01 &amp; (lastSvState &gt;&gt; ch) )
                    {

                        printf(<span class="stringliteral">"&gt;&gt;&gt; volt-ch %d out of range (%dmV..%dmV)\n"</span>,
                            ch,
                            G_VoltCh[ch].low,
                            G_VoltCh[ch].high);
                    }
                }
            }
        } <span class="keywordflow">while</span>( (UOS_KeyPressed() == -1) );

        printf(<span class="stringliteral">"\n"</span>);
    }


    <span class="comment">/*--------------------+</span>
<span class="comment">    |  sw reset           |</span>
<span class="comment">    +--------------------*/</span>
    <span class="comment">/* Software cold reset */</span>
    <span class="keywordflow">if</span>( scr != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_SWCOLDRESET, scr)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_SWCOLDRESET"</span>);
            <span class="keywordflow">goto</span> abort;
        }
    }

    <span class="comment">/* Software warm reset */</span>
    <span class="keywordflow">if</span>( swr != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_SWRESET, swr)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_SWRESET"</span>);
            <span class="keywordflow">goto</span> abort;
        }
    }

    <span class="comment">/*----------------------+</span>
<span class="comment">    |  show error counters  |</span>
<span class="comment">    +----------------------*/</span>
    <span class="keywordflow">if</span>( err != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        printf(<span class="stringliteral">"Error Counters:\n"</span>);

        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_NUM_ERRCNTRS, &amp;errCntrNbr)) &lt; 0)
        {
            <span class="keywordflow">if</span>( UOS_ErrnoGet() == ERR_LL_UNK_CODE )
                errCntrNbr = <a class="code" href="xm01bc__drv_8h.html#a64">XM01BC_NUM_ERR_CNTRS</a>;
            <span class="keywordflow">else</span>
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_NUM_ERRCNTRS"</span>);
                <span class="keywordflow">goto</span> abort;
            }
        }

        <span class="comment">/* error counter 0 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 0 )
        {
            <span class="keywordflow">if</span>( M_getstat(G_Path, XM01BC_ERRCNT_00, &amp;val) &lt; 0 )
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_00"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_00      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 1 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 1 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_01, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_01"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_01      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 2 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 2 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_02, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_02"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_02      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 3 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 3 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_03, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_03"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_03      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 4 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 4 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_04, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_04"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_04      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 5 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 5 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_05, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_05"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_05      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 6 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 6 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_06, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_06"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_06      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 7 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 7 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_07, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_07"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_07      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 8 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 8 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_08, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_08"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_08      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 9 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 9 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_09, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_09"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_09      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 10 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 10 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_10, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_10"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_10      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 11 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 11 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_11, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_11"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_11      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 12 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 12 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_12, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_12"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_12      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 13 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 13 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_13, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_13"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_13      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 14 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 14 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_14, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_14"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_14      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 15 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 15 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_15, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_15"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_15      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 16 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 16 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_16, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_16"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_16      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 17 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 17 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_17, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_17"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_17      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 18 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 18 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_18, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_18"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_18      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 19 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 19 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_19, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_19"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_19      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 20 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 20 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_20, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_20"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_20      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 21 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 21 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_21, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_21"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_21      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 22 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 22 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_22, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_22"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_22      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 23 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 23 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_23, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_23"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_23      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 24 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 24 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_24, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_24"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_24      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 25 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 25 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_25, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_25"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_25      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 26 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 26 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_26, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_26"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_26      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 27 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 27 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_27, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_27"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_27      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 28 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 28 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_28, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_28"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_28      : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 29 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 29 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_29, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_29"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_29              : %u\n"</span>, (u_int8)val );
        }

        <span class="comment">/* error counter 30 */</span>
        <span class="keywordflow">if</span>( errCntrNbr &gt; 30 )
        {
            <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERRCNT_30, &amp;val)) &lt; 0)
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERRCNT_30"</span>);
                <span class="keywordflow">goto</span> abort;
            }
            printf(<span class="stringliteral">"- XM01BC_ERRCNT_30      : %u\n"</span>, (u_int8)val );
        }
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*--------------------+</span>
<span class="comment">    |  clr error counters |</span>
<span class="comment">    +--------------------*/</span>
    <span class="keywordflow">if</span>( clear != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        printf(<span class="stringliteral">"Clearing error counters...\n"</span>);
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_ERRCNT_CLR, 0)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_ERRCNT_CLR"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"done.\n"</span>);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  get number of error counters     |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( getNumErrCntrs != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_NUM_ERRCNTRS, &amp;val)) &lt; 0)
        {
            <span class="keywordflow">if</span>( UOS_ErrnoGet() == ERR_LL_UNK_CODE )
                printf(<span class="stringliteral">"Number of Error Counters: Function not supported by driver\n\n"</span>);
            <span class="keywordflow">else</span>
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_NUM_ERRCNTRS"</span>);
                <span class="keywordflow">goto</span> abort;
            }
        }
        <span class="keywordflow">else</span>
        {
            printf(<span class="stringliteral">"Number of Error Counters: %u\n"</span>, (u_int8)val);
            printf(<span class="stringliteral">"\n"</span>);
        }
    }

    <span class="comment">/*-------------------------------+</span>
<span class="comment">    |  show firmware revision        |</span>
<span class="comment">    +-------------------------------*/</span>
    <span class="keywordflow">if</span>( frev != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        M_SG_BLOCK  blk;
        <span class="keywordtype">char</span>        rev[6];

        blk.size = <span class="keyword">sizeof</span>(rev);
        blk.data = (<span class="keywordtype">void</span>*)&amp;rev;

        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_BLK_FWREV, (int32*)&amp;blk)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_BLK_FWREV"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Firmware rev.           : %c%c.%c%c.%c%c\n"</span>,
            rev[0],rev[1],rev[2],rev[3],rev[4],rev[5]);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  show firmware revision extended  |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( frev_ext != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        M_SG_BLOCK  blk;
        u_int16     rev[3];

        blk.size = <span class="keyword">sizeof</span>(rev);
        blk.data = (<span class="keywordtype">void</span>*)&amp;rev;

        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_BLK_FWREV_EXT, (int32*)&amp;blk)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_BLK_FWREV_EXT"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Firmware rev. (extended): %02u.%02u.%02u\n"</span>, rev[0],rev[1],rev[2]);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  show last reset reason           |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( lastReason != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERR_RST_RSN, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERR_RST_RSN"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Last reset reason       : 0x%02x\n"</span>, (u_int8)val);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  show last error                  |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( lastError != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERR_LAST, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERR_LAST"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Last error              : 0x%02x\n"</span>, (u_int8)val);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  show power failure flags         |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( powerFail != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_ERR_PWR_FLGS, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_ERR_PWR_FLGS"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Power failure flags     : 0x%02x\n"</span>, (u_int8)val);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  clear power failure flags        |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( clearFail != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        printf(<span class="stringliteral">"Clearing failure registers...\n"</span>);
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_ERR_REG_CLR, 0)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_ERR_REG_CLR"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"done.\n"</span>);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  show operating hours counter     |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( opHours != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_OPHRS_CNT, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_OPHRS_CNT"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Operating hours         : %uh\n"</span>, (u_int16)val);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  show power cycle counter         |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( pwrCycle != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> )
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_PWRCYCL_CNT, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_PWRCYCL_CNT"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"Power cycles            : %u\n"</span>, (u_int16)val);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  set LED state                    |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( setLedState != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_LED_CTRL, newLedState)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_LED_CTRL"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        <span class="comment">/* show new led state */</span>
        getLedState = 1;
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  get LED state                    |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( getLedState != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_LED_CTRL, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_LED_CTRL"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"LED state               : %s\n"</span>, (val ? <span class="stringliteral">"On"</span> : <span class="stringliteral">"Off"</span>) );
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  get power resume mode            |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( getResumeMode != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_RESUME_MODE, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_RESUME_MODE"</span>);
            <span class="keywordflow">goto</span> abort;
        }

        printf(<span class="stringliteral">"Power Resume mode       : "</span>);

        <span class="keywordflow">switch</span>(val)
        {
            <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a57">XM01BC_RESUME_OFF</a>:
                printf(<span class="stringliteral">"Off\n"</span>);
                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a58">XM01BC_RESUME_ON</a>:
                printf(<span class="stringliteral">"On\n"</span>);
                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a59">XM01BC_RESUME_FORMER</a>:
                printf(<span class="stringliteral">"Former State\n"</span>);
                <span class="keywordflow">break</span>;

            <span class="keywordflow">default</span>:
                printf(<span class="stringliteral">"invalid (0x%02x)\n"</span>, (u_int8)val);
                <span class="keywordflow">break</span>;

        }
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  get RESET_IN Blocking mode       |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( getResetMode != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_RST_IN_MODE, &amp;val)) &lt; 0)
        {
            <span class="keywordflow">if</span>( UOS_ErrnoGet() == ERR_LL_UNK_CODE )
                printf(<span class="stringliteral">"RESET_IN Blocking mode  : Function not supported by driver\n\n"</span>);
            <span class="keywordflow">else</span>
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_RES_IN_MODE"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        <span class="keywordflow">else</span>
        {
            printf(<span class="stringliteral">"RESET_IN Blocking mode  : "</span>);

            <span class="keywordflow">switch</span>(val)
            {
                <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a62">XM01BC_RST_IN_ENABLED</a>:
                    printf(<span class="stringliteral">"not blocked\n"</span>);
                    <span class="keywordflow">break</span>;

                <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a63">XM01BC_RST_IN_BLOCKED</a>:
                    printf(<span class="stringliteral">"blocked\n"</span>);
                    <span class="keywordflow">break</span>;

                <span class="keywordflow">default</span>:
                    printf(<span class="stringliteral">"invalid (0x%02x)\n"</span>, (u_int8)val);
                    <span class="keywordflow">break</span>;

            }
            printf(<span class="stringliteral">"\n"</span>);
        }

    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  get EXT_PWR_OK mode              |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( getExtMode != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_EXT_PWR_OK_MODE, &amp;val)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_EXT_PWR_OK_MODE"</span>);
            <span class="keywordflow">goto</span> abort;
        }

        printf(<span class="stringliteral">"EXT_PWR_OK mode         : "</span>);

        <span class="keywordflow">switch</span>(val)
        {
            <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a60">XM01BC_EXT_PWR_OK_IGN</a>:
                printf(<span class="stringliteral">"Check on start only\n"</span>);
                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="xm01bc__drv_8h.html#a61">XM01BC_EXT_PWR_OK_ERR</a>:
                printf(<span class="stringliteral">"Check always\n"</span>);
                <span class="keywordflow">break</span>;

            <span class="keywordflow">default</span>:
                printf(<span class="stringliteral">"invalid (0x%02x)\n"</span>, (u_int8)val);
                <span class="keywordflow">break</span>;

        }
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  get hardware variant             |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( getHwVariant != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        <span class="keywordflow">if</span> ((M_getstat(G_Path, XM01BC_HW_VARIANT, &amp;val)) &lt; 0)
        {
            <span class="keywordflow">if</span>( UOS_ErrnoGet() == ERR_LL_UNK_CODE )
                printf(<span class="stringliteral">"Detected Hardware ID    : Function not supported by driver\n\n"</span>);
            <span class="keywordflow">else</span>
            {
                <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"getstat XM01BC_HW_VARIANT"</span>);
                <span class="keywordflow">goto</span> abort;
            }
        }
        <span class="keywordflow">else</span>
        {
            printf(<span class="stringliteral">"Detected Hardware ID    : 0x%04x\n"</span>, (u_int16)val);
            printf(<span class="stringliteral">"\n"</span>);
        }
    }

    <span class="comment">/*----------------------------------+</span>
<span class="comment">    |  exit QM mode                     |</span>
<span class="comment">    +----------------------------------*/</span>
    <span class="keywordflow">if</span>( exitQmMode != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a>)
    {
        printf(<span class="stringliteral">"leaving QM-Mode (for production tests only)...\n"</span>);
        <span class="keywordflow">if</span>( (M_setstat(G_Path, XM01BC_WDOG_ARM, 0)) &lt; 0)
        {
            <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"setstat XM01BC_WDOG_ARM"</span>);
            <span class="keywordflow">goto</span> abort;
        }
        printf(<span class="stringliteral">"done.\n"</span>);
        printf(<span class="stringliteral">"\n"</span>);
    }

    <span class="comment">/*--------------------+</span>
<span class="comment">    |  cleanup            |</span>
<span class="comment">    +--------------------*/</span>
    abort:

    <span class="keywordflow">if</span>( superv != <a class="code" href="xm01bc__ctrl_8c.html#a0">NONE</a> ){
        UOS_SigExit();
    }

    <span class="keywordflow">if</span>( M_close(G_Path) &lt; 0 )
        <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="stringliteral">"close"</span>);

    <span class="keywordflow">return</span>(0);
}

<span class="comment">/********************************* PrintMdisError **************************/</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="xm01bc__ctrl_8c.html#a7">PrintMdisError</a>(<span class="keywordtype">char</span> *info)
{
    printf(<span class="stringliteral">"*** can't %s: %s\n"</span>, info, M_errstring(UOS_ErrnoGet()));
    printf(<span class="stringliteral">"\n"</span>);
}

<span class="comment">/********************************* PrintUosError ***************************/</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="xm01bc__ctrl_8c.html#a8">PrintUosError</a>(<span class="keywordtype">char</span> *info)
{
    printf(<span class="stringliteral">"*** can't %s: %s\n"</span>, info, UOS_ErrString(UOS_ErrnoGet()));
    printf(<span class="stringliteral">"\n"</span>);
}

</pre></div> 
	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for XM01BC MDIS Driver using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2015 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

